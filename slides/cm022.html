<!DOCTYPE html>
<html>
  <head>
    <title>CONJ620: CM 2.2</title>
    <meta charset="utf-8">
    <meta name="author" content="Alison Hill" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/ohsu.css" type="text/css" />
    <link rel="stylesheet" href="css/ohsu-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# CONJ620: CM 2.2
## Coding Style + Linear Models
### Alison Hill

---








class: center, middle

# Coding style

---

## Style guide

&gt;"Good coding style is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread."
&gt;
&gt;Hadley Wickham

- Style guide for this course is based on the Tidyverse style guide: http://style.tidyverse.org/

- There's more to it than what we'll cover today, but we'll mention more as we introduce more functionality, and do a recap later in the semester

---

## File names and code chunk labels

- Do not use spaces in file names, use `-` or `_` to separate words
- Use all lowercase letters


```r
# Good
ucb-admit.csv

# Bad
UCB Admit.csv
```

---

## Object names

- Use `_` to separate words in object names
- Use informative but short object names
- Do not reuse object names within an analysis


```r
# Good
acs_employed

# Bad
acs.employed
acs2
acs_subset
acs_subsetted_for_males
```

---

## Spacing

- Put a space before and after all infix operators (=, +, -, &lt;-, etc.), and when naming arguments in function calls. 
- Always put a space after a comma, and never before (just like in regular English).


```r
# Good
average &lt;- mean(feet / 12 + inches, na.rm = TRUE)

# Bad
average&lt;-mean(feet/12+inches,na.rm=TRUE)
```

---

## ggplot

- Always end a line with `+`
- Always indent the next line


```r
# Good
ggplot(diamonds, mapping = aes(x = price)) +
  geom_histogram()

# Bad
ggplot(diamonds,mapping=aes(x=price))+geom_histogram()
```

---

## Long lines

- Limit your code to 80 characters per line. This fits comfortably on a printed page with a reasonably sized font.

- Take advantage of RStudio editor's auto formatting for indentation at line breaks.

---

## Assignment

- Use `&lt;-` not `=`


```r
# Good
x &lt;- 2

# Bad
x = 2
```

---

## Quotes

Use `"`, not `'`, for quoting text. The only exception is when the text already contains double quotes and no single quotes.


```r
ggplot(diamonds, mapping = aes(x = price)) +
  geom_histogram() +
  # Good
  labs(title = "`Shine bright like a diamond`",
  # Good
       x = "Diamond prices",
  # Bad
       y = 'Frequency')
```

---
## Back to linear models

---

## Vocabulary

- **Response variable:** Variable whose behavior or variation you are trying to understand, on the y-axis (dependent variable)

--

- **Explanatory variables:** Other variables that you want to use to explain the variation in the response, on the x-axis (independent variables)

--

- **Predicted value:** Output of the function **model function**
    - The model function gives the typical value of the response variable
    *conditioning* on the explanatory variables

--

- **Residuals:** Show how far each case is from its model value
    - Residual = Observed value - Predicted value
    - Tells how far above/below the model function each case is

---

## What do you see?


`$$\widehat{\textrm{criminals}} = b_0 + b_1~\textrm{public_houses}$$`


![](cm022_files/figure-html/unnamed-chunk-7-1.png)&lt;!-- --&gt;

---

## Use your words


--

There seems to be a moderately strong relationship. The slope of the regresion line is positive, also the correlation coefficient of 0.46 is moderate. Meaning as public houses increase, there is an associated increase in criminal activity.

--

![](cm022_files/figure-html/unnamed-chunk-8-1.png)&lt;!-- --&gt;
---

## Visualizing the linear model

... without the measure of uncertainty around the line

![](cm022_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;

---

## Visualizing the linear model

What do you see?

![](cm022_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;


---

## Visualizing the linear model

Caution: extrapolating...

![](cm022_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;
---

## Residuals

What does a negative residual mean? 

Which counties on the plot have negative residuals, those below or above the line?


![](cm022_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;

---

## Models - upsides and downsides

- Models can sometimes reveal patterns that are not evident in a graph of the
data. This is a great advantage of modelling over simple visual inspection of
data. 

- There is a real risk, however, that a model is imposing structure that is
not really there on the scatter of data, just as people imagine animal shapes in
the stars. A skeptical approach is always warranted.

---

## Variation around the model...

is just as important as the model, if not more!

*Statistics is the explanation of variation in the context of what remains
unexplained.*

- The scatter suggests that there might be other factors that account for large parts 
of painting-to-painting variability, or perhaps just that randomness plays a big role.

- Adding more explanatory variables to a model can sometimes usefully reduce
the size of the scatter around the model. (We'll talk more about this later.)

---
## Criminals &amp; public houses


```r
(crime_from_ph &lt;- lm(criminals ~ public_houses, data = crime))
```

```
## 
## Call:
## lm(formula = criminals ~ public_houses, data = crime)
## 
## Coefficients:
##   (Intercept)  public_houses  
##      109.3399         0.1162
```

--

&lt;br&gt;

`$$\widehat{\textrm{criminals}} = 109.34 + .12~\textrm{public_houses}$$`
--

- **Slope:** For each additional public house per 100k people, the crime per 100k people is expected to be higher, on average, by 0.12.

--

- **Intercept:** Counties with 0 public houses are expected to have crime rates at 109.34 per 100k people, on average.
    - Does this make sense?

---
## Intercept

- **Intercept:** Counties with 0 public houses are expected to have crime rates at 109.34 per 100k people, on average.
    - Does this make sense? 
    - Do we have any counties with 0?
    

```r
crime %&gt;% 
  filter(public_houses == 0)
```

```
## # A tibble: 0 x 7
## # ... with 7 variables: county &lt;chr&gt;, region_name &lt;chr&gt;,
## #   region_code &lt;dbl&gt;, criminals &lt;dbl&gt;, public_houses &lt;dbl&gt;,
## #   school_attendance &lt;dbl&gt;, worship_attendance &lt;dbl&gt;
```

While the intercept has a mathematical interpretation (it situates the vertical location of the line), it may not always have a practical one.

---

## Least squares regression

The regression line minimizes the sum of squared residuals.

$$ \hat{y} = b_0 + b_1~x $$
What is another (equivalent) way to say the same thing?

--

$$ y = b_0 + b_1~x + e $$

$$ y = \hat{y} + e $$

--

If `\(e_i = y_i - \hat{y_i}\)`,

then, the regression line minimizes `\(\sum_{i = 1}^n e_i^2\)`.

---

## Visualizing residuals

![](cm022_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;


---

## Visualizing residuals (cont.)

![](cm022_files/figure-html/unnamed-chunk-16-1.png)&lt;!-- --&gt;

---

## Visualizing residuals (cont.)

![](cm022_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;



---

## Properties of the least squares regression line

- The regression line goes through the center of mass point, the coordinates corresponding to average `\(x\)` and average `\(y\)`: `\((\bar{x}, \bar{y})\)`:

`$$\hat{y} = b_0 + b_1 x ~ \rightarrow ~ b_0 = \hat{y} - b_1 x$$`

- The slope has the same sign as the correlation coefficient:

`$$b_1 = r \frac{s_y}{s_x}$$`

- The sum of the residuals is zero: 
`$$\sum_{i = 1}^n e_i = 0$$`

- The residuals and `\(x\)` values are uncorrelated.

---
## A thought experiment...(1)

![](cm022_files/figure-html/unnamed-chunk-18-1.png)&lt;!-- --&gt;

---
## A thought experiment...(2)

![](cm022_files/figure-html/unnamed-chunk-19-1.png)&lt;!-- --&gt;

---
## A thought experiment...(2)

"The turquoise points are what we would expect to see if there was `___` association between `public_houses` and `criminals`"

![](cm022_files/figure-html/unnamed-chunk-20-1.png)&lt;!-- --&gt;
---
## A thought experiment...(2)

"The bright blue points are what we would expect to see if there was `___` a `___` of 0.46 between `public_houses` and `criminals`"

![](cm022_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;

---
## A thought experiment...3 "models"?

1. Zero association between the variables (aka, the mean / null model)
2. An exact association of 0.46 between the variables
3. The data itself

![](cm022_files/figure-html/unnamed-chunk-22-1.png)&lt;!-- --&gt;


---
## A thought experiment...

Are there any other "differences" we can calculate with this set of 3 points/models?

![](cm022_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;

---
## A thought experiment...

Ignore the regression line/predicted points: What would the magnitude of the differences between the observed `criminals` values and the mean value tell us? *(remember what we said the mean line represented: `___` correlation between variables)*

--

![](cm022_files/figure-html/unnamed-chunk-24-1.png)&lt;!-- --&gt;

---
## What about spread?

Variance is calculated by taking the sum of squared differences from the mean, and dividing by `N-1`



```
## # A tibble: 1 x 2
##   var_crime sd_crime
##       &lt;dbl&gt;    &lt;dbl&gt;
## 1     1715.     41.4
```

--



```r
crime %&gt;% 
  mutate(sq_diff = (criminals - mean(criminals))^2) %&gt;% 
  summarize(sum_sq_diff = sum(sq_diff),
            sum_divide_n = sum_sq_diff / (n() - 1),
            sq_sum_divide_n = sqrt(sum_divide_n))
```

```
## # A tibble: 1 x 3
##   sum_sq_diff sum_divide_n sq_sum_divide_n
##         &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;
## 1      66898.        1715.            41.4
```


---
## A thought experiment...

Take another look: the sum of squared differences between the `___` and the `___` values of `criminals` is the numerator of the variance (said another way, divide by `N-1` to get `var(criminals)`)

--

![](cm022_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;

---
## A thought experiment...

The __"Sums of Squares Total"__ is the total amount of error present when the most basic model is applied to the data. 

--

What is the "most basic model"?

--

![](cm022_files/figure-html/unnamed-chunk-28-1.png)&lt;!-- --&gt;

---
## A thought experiment...

Where are the residuals here?

--

![](cm022_files/figure-html/unnamed-chunk-29-1.png)&lt;!-- --&gt;

---
## A thought experiment...

The __"Sums of Squares Residual"__ is the total amount of error present when the best-fitting linear model is applied to the data. 

--

What is the "best fitting linear model"?

![](cm022_files/figure-html/unnamed-chunk-30-1.png)&lt;!-- --&gt;

---
## A thought experiment...(last!)

What about the difference between the mean and predicted values?

![](cm022_files/figure-html/unnamed-chunk-31-1.png)&lt;!-- --&gt;

---
## A thought experiment...(last!)

The __"Sums of Squares Model"__ is the total amount of error present when the fitted values from the best-fitting linear model are compared to the fitted values from the most basic model.

![](cm022_files/figure-html/unnamed-chunk-32-1.png)&lt;!-- --&gt;

---
## All together now

.pull-left[
`$$SS_{total}$$`
![](cm022_files/figure-html/unnamed-chunk-33-1.png)&lt;!-- --&gt;

]

.pull-right[
`$$SS_{residual}$$`
![](cm022_files/figure-html/unnamed-chunk-34-1.png)&lt;!-- --&gt;

`$$SS_{model}$$`
![](cm022_files/figure-html/unnamed-chunk-35-1.png)&lt;!-- --&gt;
]



---
## Summing the sums of squares

`$$SS_{total} = SS_{model} + SS_{residual}$$`


total variation = "explained" variation + residual ("left over") variation

---
## All of statistics

$$ \textrm{outcome}_i = \textrm{(Model}_i) + \textrm{error}_i$$

What is the outcome and model for:

- Sum of squares total?
- Sum of squares residual?
- Sum of squares model?
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "atelier-lakeside-light",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
